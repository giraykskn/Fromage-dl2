# 1. Introduction

Large language models (LLM) have demonstrated impressive performance in natural language processing (NLP) tasks, but they lack the ability to utilize visual cues for learning and reasoning about the real world. Additionally, they are unable to generate images, which is a crucial aspect of multimodal communication. A novel approach called FROMAGe [1] is proposed, which leverages a frozen LLM and a visual encoder to enable in-context learning for multimodal tasks. 

FROMAGe uses a frozen LLM and a visual encoder. Both models can produce embeddings of different modalities separately, but they cannot interact with each other to explore multi-modal context. FROMAGe proposes a framework for creating an interaction layer between both models. The embeddings generated from the language model are mapped to the visual encoder's vector space using linear transformation to allow LLM to interact with the visual encoder. To generate an embedding for an image using the text input, they propose extending the vocabulary of LLM with the [RET] token. This represents an embedding of an image from the text input, which is learned during training to map the text space into the image space. They use the contrastive loss to learn the mapping. Moreover, with this approach, learning to generate the [RET] token for multi-modal dialogue emerges. Similar to text-visual embedding mapping, they also map the visual embedding to the text space using linear mapping. They use maximum likelihood estimation to learn the mapping.

The paper builds on the shortcomings and prior knowledge that previous work has provided. For example, Flamingo [2] proposed a visual language model for text generation; however, Flamingo cannot generate images. LIMBeR [3] analyzes pretrained vision and language models and finds that learned representations are functionally equivalent up to a linear transform. Therefore, the authors propose to learn linear mappings for both modalities to be able to generate images while reasoning in a multi-modal setting.

The FROMAGe model is tested using multi-modal tasks, such as image retrieval and image captioning. The results provide evidence that this method is not only feasible for multi-modal learning, but it also maintains the existing capabilities of pre-trained text-only LLMs, such as in-context learning and greater sensitivity to input context. FROMAGe can use the additional descriptions to improve retrieval accuracy (9.0 to 10.4 on R@1). When prompted with the full multimodal context (i.e., 5 images and 4 stories), the model can learn in-context to synthesize plausible story-like text. We decided to reproduce image retrieval experiment to further explore the claims made by the FROMAGe paper and gain an understanding of the in-context learning capabilities with multi modal context.

In our reproduction we had three different settings, 1 caption, 5 captions, and 5 captions and 4 images. Unlike the claims made by the paper, we found that including 4 images and 5 captions lead to lower recall than 5 captions. We explore the possible reasons for this finding in the discussion section of the post. After reproducing the paper we shifted our focus on the extension.

We decided to explore prompting techniques to exploit the in-context learning capabilities of the FROMAGe model using few-shot learning. Frozen [4] suggests that their work should be seen as a starting point or baseline for the area of research of multimodal few-shot learning. Therefore, we use their paper as a reference for our few-shot learning procedure. In this work, we aim to quantify to what extent the FROMAGe model can adapt to novel and out-of-domain tasks rapidly. Furthermore, we aim to verify that prompting with both visual and language information in few-shot learning is strictly more effective than prompting with language alone.
We utilized the Open-Ended miniImageNet generated by Frozen to evaluate our FROMAGe model’s performance in few-shot learning scenarios. Specifically, we employed the 2-way and 5-way few-shot learning tasks using non-existing classes such as ’blicket’ and ’dax,’ which acted as replacements for existing classes like ’dog’ and ’cat.’ Each class was associated with corresponding images and provided to the FROMAGe model as prompts, along with a query image and a question about its class. We varied the number of inner-shots and repeats and evaluated the model’s query performance in terms of accuracy. We compared FROMAGe models' accuracy agains the Frozen.

The results from our extension aligned with the findings of the Frozen paper. We observed that 2-way classification performed better than 5-way classification, as the model had to learn fewer classes. Furthermore, increasing the number of inner-shots and repeats generally led to improved performance, except for the 2-way, 5-inner-shot, 5-repeat and 2-way, 3-inner-shot and 5-repeat scenario.
This could be attributed to the increased input length, which caused the model to struggle with focusing on specific contexts. Moreover, we find that FROMAGe model is less accuracte than the frozen. We also noticed that the accuracy remained below chance level, possibly suggesting that the model did not fully grasp the meaning of the out-of-vocabulary words.

<!-- Regarding your second contribution, comparing the multimodal and text-only few-shot learning capabilities of FROMAGE, what do you expect to find? Do you anticipate that the model will perform better with multimodal prompts, or do you think that language prompts alone will be sufficient for few-shot learning?

Finally, for your third contribution, which benchmark models do you plan to compare FROMAGE against? What metrics will you use to evaluate performance?
] -->

# 2. Reproduction 

In this project, we focused on reproducing the visual storytelling experiment using the VIST dataset, as outlined in section 4.1 in the original paper. Our aim was to evaluate the FROMAGe model's ability to learn in context and transfer knowledge in a zero-shot setting. To streamline the process and save time and computational resources, we chose not to evaluate the CLIP model and instead focused solely on assessing the performance of the FROMAGe model. The experiment comprised three different settings, each varying in the input provided: 1 caption, 5 captions, and 5 captions accompanied by 4 images. Since the FROMAGe model is not generative and relies on an embedding data store to match input embeddings during image retrieval, this posed a challenge. The original precomputed embeddings were cc3m embeddings, which the model was trained on. However, to ensure accurate image retrieval for this specific experiment, the model needed to encode the images from the VIST dataset as well. The paper lacked concrete instructions in this regard. To address this issue, we decided to encode the last image (target image) of each story. This ensured that each precomputed embedding corresponded to a specific story that needed to be predicted. By doing so, I ensured that the total probability across the entire test set summed to one, indicating that no precomputed embeddings were left unused. Additionally, we took the initiative to remove any duplicated target images from the dataset. This step prevented the model from retrieving multiple identical images within a single pass, leading to more diverse and meaningful results.

As a result of the aforementioned ambiguities, the reproduced results deviate to some extent from those reported in the paper. Notably, in the experiments involving inputs with 1 caption and 5 captions, the recall values exhibit a consistent trend. The model performs better when provided with 5 captions compared to just 1 caption across all three recall levels. This suggests that having more context benefits the model in understanding the sequential nature of the story, thereby increasing the probability of retrieving the correct image. However, the results for the input of 5 captions and 4 images do not align with expectations. At recall@1, the performance is even worse than when the model is provided with only 1 caption at the same recall level. On the other hand, at recall@5 and recall@10, it performs better than the model with 1 caption but falls short of the performance achieved with 5 captions. The recall values for all three settings are depicted in the following figure:

| |Recall@1|Recall@5|Recall@10|
|:----|:----|:----|:----|
|1 caption|17.7|35.1|43.9|
|5 captions|21.0|43.8|53.1|
|5 captions, 4 images|16.5|37.1|46.2|

It can be seen that overall recall values surpass those reported in the paper. This difference in performance could be attributed to the construction of the precomputed embedding space. In our implementation, we encoded only the target images to serve as the model's search space. Consequently, it becomes relatively easier for the model to retrieve the correct images, potentially leading to higher recall values overall. The following example at recall@1 illustrate the model outputs:

***Original Story:***
<img src="blogpost_imgs/Story.png" alt="Plot" width="1000" height="200">

***Output -- caption 1 / recall@1:***

<img src="blogpost_imgs/Output1caption1image0recall1.png" alt="Plot" width="250" height="200">

***Output -- captions 5 / recall@1:***

<img src="blogpost_imgs/Output1caption5image0recall1.png" alt="Plot" width="250" height="200">

***Output -- captions 5, images 4 / recall@1:***

<img src="blogpost_imgs/Output1caption5image4recall1.png" alt="Plot" width="250" height="200">

It can be seen from the previous example that model using 5 captions only has the best understanding of story context therefore the retrieved image is most similar to the ground truth while the other two retrieved the same image. Another example to illustrate outputs at recall@5:

***Original Story:***
<img src="blogpost_imgs/Story2.png" alt="Plot" width="1000" height="200">

***Output -- captions 5 / recall@5:***
<img src="blogpost_imgs/Output1caption5image0recall5.png" alt="Plot" width="1000" height="200">

Since model can retrieve multiple images to match the taret image, the performance is expetectly better than only retrieving one iamge.

There are a couple of potential factors that could explain the discrepancies between our reproduced results and those reported in the paper. One possible reason is the differences in the experimental settings between our reproduction and the original study. For instance, the construction of precomputed embeddings or variations in how recalls are calculated might have an impact on the outcomes. Another aspect to consider is the potential impact of dataset changes. Over time, some URLs associated with the images in the dataset may have become invalid or inaccessible. While we attempted to mitigate this issue by randomly sampling from the entire dataset for our experiments, it is still possible that these changes in the availability of certain images could have influenced the results to some degree, although the likelihood of significant impact is relatively low. Overall, it is essential to acknowledge these factors and consider them when interpreting the differences between our reproduced results and the findings presented in the original paper. 

In conclusion, the FROMAGe model demonstrates a certain degree of effectiveness in contextual learning and zero-shot transfer. Despite the discrepancies observed in the reproduced results, the model generally performs well on the test dataset. For future investigations, it would be valuable to explore the model's capabilities using alternative datasets to assess its similar abilities in different contexts.

## 2.1 Strengths 

1. Effective multimodal generation: 

The model effectively leverages pretrained language models that are available to generate coherent captions for images and relevant multimodal dialogues, since it grounds the language models to images.

2. Training Efficiency

FROMAGe is trained by just finetuning a small set of parameters, which makes it easy to train. This makes it much easier to conduct further research on the model and the paper and the model can be applied to many specific fields like medicine, fashion etc. by finetuning again.

3. Usage Versatility

FROMAGe is applicable to many different areas, such as captioning, image-text retrieval, multimodal dialogue which shows its broad potential.

4. Detailed results

The paper and the code they publish are very clear, which leaves less room for misunderstanding. The background, experiment and analysis are detailed, and shows the strengths and weaknesses of the model based on what they explored.

## 2.2 Weaknesses

1. Limited exploration of the model:

The paper does not fully explore the capabilities in the model in terms of datasets, hyperparameters and prompting techniques. Especially the lack of datasets and hyperparameters creates concerns over the sucess of the model, makes it seem less adaptable.

2. Too much reliance on pre-trained models:

Since FROMAGe relies mostly on pre-trained models, it is difficult to understand if the results are more influenced by FROMAGe or the models beneath. The model also inherits all the bias and limitations of the mentioned models, which can create ethical issues.

3. Limited analysis on failure:

Although the research is very detailed, there is not much talk about the failures of the model and why it happens besides the appendix.


# 3. Our Novel Contribution

![#f03c15](https://placehold.co/15x15/f03c15/f03c15.png) `TODO: Change this. include the example prompt - it is already in the github in the folder blogpost_imgs`

Our contributions are as follows:

1. Test the few-shot learning capabilities of the FROMAGe model in a multimodal setting.

2. Further analyze the multimodal vs. text-only few-shot learning capabilities of the FROMAGe model.

3. Compare the FROMAGe model to existing benchmark models and quantify the differences.


To test if the FROMAGe model can perform in-context learning, our inspiration is Tsimpoukelli et al. (2021)(Figure 4). We use their dataset - Open Ended Mini ImageNet. It consists of images and their corresponding captions. The interesting part is the captions containing words without meanings such as “dax” or “blicket”. In order to observe if the model is able to learn those words, we experiment with the different variants in the dataset. They are the variants of few-shot learning, and the dataset that we use has 1,3,5 inner-shots, along with 2 and 5 ways. We use this setting as introduced in the Frozen language model by Tsimpoukelli et al. (2021). The ways represent the number of categories (dog vs cat) and the inner-shots are used to show the amount of distinct examples given to the model per category. We apply the same technique meaning that it is possible to experiment with 1,3 or 5 images of dax or 1,3 or 5 images of blickets as the input prompt. We do this experiment to see if FROMAGe is able to perform in-context learning using a few-shot prompt. We also experiment with prompts of different lengths (only “dax” as a prompt for instance), the amount of words that are expected to be returned by the model and different temperature parameters. Another variation we try is repeating the same prompt, the number of inner-shots that are repeated when giving them to the model. We observe that with 5 repetitions, no matter how many inner-shots or ways are given, it is possible to observe higher accuracy in the outcome of the model learning a meaningless word and being able to output the correct image/caption pair for that. 

# 4. Results
In the following section we presents the experiments we performed with varying the four different parameters - task induction, ways, inner shots and repeats. The results for 2 ways with different inner shots, repeats and task induction is presented in the following table: 

|2 way| | | | | | | | | | | | | | |
|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|
|Task induction|no|no|no|no|no|no|no|no|no|yes|yes|yes|yes|yes|
|Inner Shots|1|1|1|3|3|3|5|5|5|1|3|5|1|1|
|Repeats|0|2|4|0|2|4|0|2|4|0|0|0|2|4|
|Frozen|29.0|-|-|-|-|-|-|-|-|53.4|57.9|58.9|-|-|
|FROMAGe|8.3|25.7|33.9|27.5|42.6|40.9|39.3|42.4|37.0|9.8|31.1|42.0|28.3|35.8|

From the table we see that the parameter task induction improves the performance of FROMAGe a little but not significantly. For 1 inner shot, 0, 2 and 4 repeats it improves by 2%. Hence, this does not help the model to fast-bind the two new given classes. However, with increasing the repeats for 1 shot, we observe a huge improvement - from 8.3% (with 0 repeats) to 25.7% (with 2 repeats) and 33.9% (with 4 repeats). Additionally, when we increase the number of inner shots, the accuracy also increases with up to 42.6% with 3 shots and 2 repeats. We can also see that with more inner shots, the amount of repeats is not crucial and even decreases the performance - for example with 3 inner shots and 4 repeats, the accuracy is lower than with 3 inner shots and 2 repeats. The exact same situation happens with 5 inner shots, 4 repeats and 5 inner shots 2 repeats. We attribute this to the fact that it is possible FROMAGe cannot handle too long prompts. For this reason the best performance is with 3 inner shots and 2 repeats - a good balance between the amount of inner shots and repeats. 

Similar trends can be observed in the results for 5 ways: 

|5 way| | | | | | | | | | | | | | |
|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|
|Task induction|no|no|no|no|no|no|no|no|no|yes|yes|yes|yes|yes|
|Inner Shots|1|1|1|3|3|3|5|5|5|1|3|5|1|1|
|Repeats|0|2|4|0|2|4|0|2|4|0|0|0|2|4|
|Frozen|18.0|-|-|-|-|-|-|-|-|20.2|22.3|21.3|-|-|
|FROMAGe|1.6|2.5|2.4|2.7|1.0|0.0|3.6|0.0|0.0|4.0|5.0|5.7|3.0|3.0|

Once again, the presence of task induction in the prompt helps improve the accuracy by around 2%. The prompt with 3 shots performs best with 5% accuracy. However, in both 2 and 5 ways the results of FROMAGe do not perform above chance. Additionally, when we compare FROMAGe with the baseline Frozen, it is evident that Frozen performs better. The results of Frozen with task induction are above chance and significantly higher than FROMAGe. One possible explanation for this is that FROMAGe has different pre-trained LLM and a different visual encoder than Frozen. Furthermore, while both FROMAGe and Frozen maximize the log-likelihood, Frozen also includes a visual prefix prepended to the token sequence and then maximizes the log likelihood objective. Most importantly, Frozen trains the visual encoder from scratch. In comparison, FROMAGe does not do that, it only learns a linear mapping to map the visual embeddings coming from the visual model to the language space. Hence, the visual encoder of Frozen is specifically trained for the task, while the one in FROMAGe is not.


# 5. Conclusion

In conclusion, although not all results are successfully reproduced due to some ambiguities in the paper, it still demonstrates the model's ability of in-context learning and zero-shot transfer ability inherited from large language models. The extension of performing few-shot learning on the FROMAGe model using Open-Ended miniImageNet dataset has yielded quite promising results and demonstrated the model's ability of few-shot learning and fast binding despite the discrepansies in the final accuracy scores. For future work, more datasets can be used to test similar or unexplored capbabilities of this model.

# REFERENCES:


[1]
J. Y. Koh, R. Salakhutdinov, and D. Fried, ‘Grounding Language Models to Images for Multimodal Generation’, arXiv e-prints, p. arXiv:2301.13823, Jan. 2023.

[2]
‘Flamingo: a Visual Language Model for Few-Shot Learning’, arXiv e-prints, p. arXiv:2204.14198, Apr. 2022.

[3]
J. Merullo, L. Castricato, C. Eickhoff, and E. Pavlick, ‘Linearly Mapping from Image to Text Space’, arXiv e-prints, p. arXiv:2209.15162, Sep. 2022.

[4]
M. Tsimpoukelli, J. L. Menick, S. Cabi, S. M. A. Eslami, O. Vinyals, and F. Hill, ‘Multimodal Few-Shot Learning with Frozen Language Models’, in Advances in Neural Information Processing Systems, 2021, vol. 34, pp. 200–212.




